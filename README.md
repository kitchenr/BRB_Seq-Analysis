# BRB_Seq-Analysis
Analysis for Spike in and Full Run data from BRB-Seq on the WashU HTCF

## Spike In Data
One Spike In data is returned we need to check the quality of the data to determine read numbers for the full run.

Create a new project folder with subdirectories: 
data        
        Read 1
        Read 2
        Index 1
        Index 2
metadata
        Parameters_mouse.txt
        Mapping File.txt
scripts
         BRB_Seq_Muegge_241112_TwoStage_noMulti.sh
         BRB_MultiQC_SpikeIn_240116.sh
spike_in_analysis

To start: 
After Spike In you get a file named {Project Name}_Alithea_BRBSEQ_Pipeline_V5B_Primerset_Template.xlsx and R1,R2,I1,I2 files.

The Excel sheet contains your barcodes, well locations and sample names.

We need to start by populating the "Mapping_File" tab of that sheet. You can do that by pulling / copying SampleName and Barcode information from the ReverseTranscription tab.
The group column doesn't matter a lot at this point, but if you have real group information enter it now as a placeholder.
An example mapping file is posted here.

Once the mapping file is created save it in your metadate folder along with your mouse genome reference files (example provided).

In the metadata folder you should have your mapping file and the parameters file that you can download from this repo:

In your Scripts folder you should have: BRB_MultiQC_SpikeIn_240116.sh and BRB_Seq_Muegge_241112_TwoStage_noMulti.sh.

First you run:

Run Type: Spike-in   Output: QC report
BRB_Seq_Muegge_241112_TwoStage_noMulti.sh
        input: 1) Sample <> Barcode mapping file with paths to Read1 and Read2 fastq files
               2) Parameters file with paths to genome annotation files and STAR database.

        For each sample in the mapping file this script 1) demultiplexes with cutadapt,
        2) assess quality with Fastqc, 3) removes sequencing adapters and polyA tails
        with cutadapt, 4) aligns reads to the reference genome with STAR, 4) generates
        post-alignment QC with Fastqc, RSeQC, and Qualimap, and 5) assigns features with
        subReads FeatureCounts.

Usage Template:
sbatch BRB_Seq_Muegge_241112_TwoStage_noMulti.sh PROJECT_DIRECTORY MAPPING_FILE PARAMETERS_FILE
Usage Example:
sbatch --array=1-8%8 scripts/BRB_Seq_*.sh spike_in_analysis/ metadata/spikein_map.txt metadata/parameters.csv
sbatch --array=1-48%20 scripts/SpikeIn/BRB_Seq_*.sh spike_in_analysis_test/ metadata/Test.txt metadata/parameters_mouse.txt

Change arrary 1-8 to number of your samples. %8 controls how many runs occur at the same time.

Then run: 
BRB_MultiQC_SpikeIn_240116.sh
        input: output of of BRB_Seq_Muegge_241112_TwoStage_noMulti.sh

        This script contains wrapper scripts to generate 1) an aggregated count matrix of
        all the assigned features from each sample from the output of s01, and 2) a
        html quality report generated by calling MultiQC
        

Usage Template:

sbatch BRB_MultiQC_SpikeIn_240116.sh PROJECT_DIR LIBRARY_NAME

Usage Example:

sbatch scripts/SpikeIn/BRB_MultiQC_SpikeIn_240116.sh spike_in_analysis/ Test

After this you will end up with  a MultiQC html were you can look at data quality.

You then need to copy the table from the html to this excel sheet:
Evenness_Repooling_Template_2025_1017.xlsx
to determine read number and send off for the Full run.


After you can start the Full run Analysis

# Richard's Notes

## Checking Job Status
squeue -u yourWUSTLkey

## Code for removing end of line characters (\r or \n)
sed 's/\r$//' input.txt > output.txt

